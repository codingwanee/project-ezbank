<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="certifyMapper">
	<resultMap type="certFileVO" id="certFileMap">
		<result column="REG_FID" property="regFid" />
		<result column="VISA_FID" property="visaFid" />
	</resultMap>
	
	<!-- 비대면인증 신청내역 -->
	<!-- 삽입 -->
	<insert id="insertHistory" parameterType="certHistoryVO">
		INSERT INTO TB_CERT_HISTORY
		(CERID, APPLICANT, REG_FID, VISA_FID, STATUS)
		VALUES(#{cerId},#{applicant},#{redFid},#{visaFid},#{status})
	</insert>
		
	<!-- 전체조회 -->
	<select id="selectAllHistory" resultType="certHistoryVO">
		SELECT *
		FROM TB_CERT_HISTORY
	</select>
	
	<!-- 상세조회 -->
	<select id="selectOneHistory" resultType="certHistoryVO">
		SELECT *
		FROM TB_CERT_HISTORY
		WHERE CERID = #{cerId}
	</select>
	
	<!-- certId에 대한 시퀀스 -->
	<select id="selectSeq" resultType="int">
		SELECT SEQ_CERT_HISTORY.NEXTVAL FROM DUAL
	</select>

	<!-- 파일 -->
	<!-- 신청번호에 따른 조회 -->
	<select id="selectFilesByCertId" resultType="certFileVO" resultMap="certFileMap">
		SELECT STORED_NAME 
		FROM TB_CERT_FILE 
		WHERE CERID = #{cerId}
	</select>
	
	<!-- 파일 삽입 -->
	<insert id="insertFile" parameterType="certFileVO">
		INSERT INTO TB_CERT_FILE
		(FID, CERTID,ORNAME, STNAME)
		VALUES(#{fid}, #{certId},#{orName},#{stName})
	</insert>	

</mapper>	